<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h1>
    <p>‡∏Å‡∏£‡∏≠‡∏Å <strong>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</strong> ‡∏´‡∏£‡∏∑‡∏≠ <strong>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</strong> ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>

    <div class="search-box">
      <input id="q" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô Somchai Prasit ‡∏´‡∏£‡∏∑‡∏≠ 65001">
      <button id="btn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
    </div>

    <div id="result" class="card"></div>
  </div>

  <script>
    async function loadExcel() {
      const res = await fetch("grades.xlsx");
      const data = await res.arrayBuffer();
      const wb = XLSX.read(data, {type:"array"});
      const sheet = wb.Sheets[wb.SheetNames[0]];
      return XLSX.utils.sheet_to_json(sheet, {defval:""});
    }

    document.querySelector("#btn").addEventListener("click", async ()=>{
      const q = document.querySelector("#q").value.trim().toLowerCase();
      if(!q){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"); return; }

      const rows = await loadExcel();

      // üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á StudentID ‡πÅ‡∏•‡∏∞ Name
      const match = rows.find(r => 
        String(r.StudentID||"").trim().toLowerCase() === q ||
        String(r.Name||"").trim().toLowerCase() === q
      );

      const result = document.querySelector("#result");
      if(!match){
        result.innerHTML = "<p class='not-found'>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>";
        return;
      }

      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      const SCORE_COL_PAT = /(‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô|‡πÄ‡∏Å‡πá‡∏ö|‡∏™‡∏≠‡∏ö|‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ|‡∏õ‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ|‡∏£‡∏ß‡∏°|quiz|test|score|point|mid(term)?|final|total)/i;
      const scores = Object.entries(match).filter(([k]) => SCORE_COL_PAT.test(k));

      let html = `<h2>‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á ${match.Name || match.StudentID}</h2>`;
      html += "<table><thead><tr><th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead><tbody>";
      for (const [k, v] of scores) {
        html += `<tr><td>${k}</td><td>${v}</td></tr>`;
      }
      html += "</tbody></table>";

      result.innerHTML = html;
    });
  </script>
</body>
</html>
